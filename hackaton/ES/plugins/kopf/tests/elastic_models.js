// isDefined tests
test("cluster creating", function() {
  var state = JSON.parse('{"cluster_name":"elasticsearch","master_node":"4e_2czvrSBm13l35VIcN4Q","blocks":{"indices":{"qux":{"4":{"description":"index closed","retryable":false,"levels":["read","write"]}}}},"nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"name":"Hypnotia","transport_address":"127.0.0.1:9301","attributes":{}},"4e_2czvrSBm13l35VIcN4Q":{"name":"Polaris","transport_address":"127.0.0.1:9300","attributes":{}}},"routing_table":{"indices":{"foobar":{"shards":{"1":[{"state":"STARTED","primary":true,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":1,"index":"foobar","version":2,"allocation_id":{"id":"q58EfCH4RlibTgWihHvwXA"}}],"0":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobar","version":2,"allocation_id":{"id":"Ok00ZJXCQ8qptWzbg0tNiA"}}]}},"foobaz":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"u50tX7tLSGy2VJj9YNHzGg"}},{"state":"STARTED","primary":false,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"BZc-GDVcRpGjjTj6nTscXw"}},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz","version":3,"unassigned_info":{"reason":"INDEX_CREATED","at":"2015-09-01T16:27:30.208Z"}}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz","version":3,"unassigned_info":{"reason":"INDEX_CREATED","at":"2015-09-01T16:27:30.208Z"}}],"nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobar","version":2,"allocation_id":{"id":"Ok00ZJXCQ8qptWzbg0tNiA"}},{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"u50tX7tLSGy2VJj9YNHzGg"}}],"4e_2czvrSBm13l35VIcN4Q":[{"state":"STARTED","primary":true,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":1,"index":"foobar","version":2,"allocation_id":{"id":"q58EfCH4RlibTgWihHvwXA"}},{"state":"STARTED","primary":false,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"BZc-GDVcRpGjjTj6nTscXw"}}]}}}');
  var indexStats = JSON.parse('{"_shards":{"total":5,"successful":4,"failed":0},"_all":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7243,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7370,"throttle_time_in_millis":0}}},"indices":{"foobar":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7116,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7116,"throttle_time_in_millis":0}}},"foobaz":{"primaries":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":127,"throttle_time_in_millis":0}},"total":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":254,"throttle_time_in_millis":0}}}}}');
  var nodeStats = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"timestamp":1441124851828,"name":"Hypnotia","transport_address":"127.0.0.1:9301","host":"127.0.0.1","ip":["127.0.0.1:9301","NONE"],"indices":{"docs":{"count":2,"deleted":0},"store":{"size_in_bytes":3545,"throttle_time_in_millis":0},"indexing":{"index_total":2,"index_time_in_millis":42,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0,"scroll_total":0,"scroll_time_in_millis":0,"scroll_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0,"total_stopped_time_in_millis":0,"total_throttled_time_in_millis":0,"total_auto_throttle_in_bytes":293601280},"refresh":{"total":2,"total_time_in_millis":56},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":4},"query_cache":{"memory_size_in_bytes":0,"total_count":0,"hit_count":0,"miss_count":0,"cache_size":0,"cache_count":0,"evictions":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":3140,"terms_memory_in_bytes":2696,"stored_fields_memory_in_bytes":312,"term_vectors_memory_in_bytes":0,"norms_memory_in_bytes":40,"doc_values_memory_in_bytes":92,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":144},"translog":{"operations":1,"size_in_bytes":43},"suggest":{"total":0,"time_in_millis":0,"current":0},"request_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0},"recovery":{"current_as_source":0,"current_as_target":0,"throttle_time_in_millis":0}},"os":{"timestamp":1441124851833,"load_average":2.38037109375,"mem":{"total_in_bytes":8589934592,"free_in_bytes":33062912,"used_in_bytes":8556871680,"free_percent":0,"used_percent":100},"swap":{"total_in_bytes":2147483648,"free_in_bytes":1561591808,"used_in_bytes":585891840}},"process":{"timestamp":1441124851833,"open_file_descriptors":262,"max_file_descriptors":10240,"cpu":{"percent":0,"total_in_millis":13524},"mem":{"total_virtual_in_bytes":5296508928}},"jvm":{"timestamp":1441124851833,"uptime_in_millis":170342,"mem":{"heap_used_in_bytes":55240456,"heap_used_percent":5,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":52334240,"non_heap_committed_in_bytes":53141504,"pools":{"young":{"used_in_bytes":34679280,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":8756448,"max_in_bytes":35782656,"peak_used_in_bytes":8912888,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":11804728,"max_in_bytes":715849728,"peak_used_in_bytes":11804728,"peak_max_in_bytes":715849728}}},"threads":{"count":86,"peak_count":96},"gc":{"collectors":{"young":{"collection_count":5,"collection_time_in_millis":62},"old":{"collection_count":1,"collection_time_in_millis":16}}},"buffer_pools":{"direct":{"count":96,"used_in_bytes":15232813,"total_capacity_in_bytes":15232813},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_started":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":6},"listener":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":5,"completed":334},"warmer":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":40},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_store":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":9},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":69},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"fs":{"timestamp":1441124851834,"total":{"total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032},"data":[{"path":"/Users/leonardo.menezes/Downloads/elastic/elasticsearch-2.0.0-beta1/data/elasticsearch/nodes/1","mount":"/ (/dev/disk1)","type":"hfs","total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032}]},"transport":{"server_open":13,"rx_count":661,"rx_size_in_bytes":112203,"tx_count":656,"tx_size_in_bytes":63905},"http":{"current_open":0,"total_opened":0},"breakers":{"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}},"script":{"compilations":0,"cache_evictions":0}},"4e_2czvrSBm13l35VIcN4Q":{"timestamp":1441124851827,"name":"Polaris","transport_address":"127.0.0.1:9300","host":"127.0.0.1","ip":["127.0.0.1:9300","NONE"],"indices":{"docs":{"count":6,"deleted":0},"store":{"size_in_bytes":3825,"throttle_time_in_millis":0},"indexing":{"index_total":6,"index_time_in_millis":53,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0,"scroll_total":0,"scroll_time_in_millis":0,"scroll_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0,"total_stopped_time_in_millis":0,"total_throttled_time_in_millis":0,"total_auto_throttle_in_bytes":314572800},"refresh":{"total":2,"total_time_in_millis":64},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":7,"total_time_in_millis":2},"query_cache":{"memory_size_in_bytes":0,"total_count":0,"hit_count":0,"miss_count":0,"cache_size":0,"cache_count":0,"evictions":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":3140,"terms_memory_in_bytes":2696,"stored_fields_memory_in_bytes":312,"term_vectors_memory_in_bytes":0,"norms_memory_in_bytes":40,"doc_values_memory_in_bytes":92,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":72},"translog":{"operations":5,"size_in_bytes":43},"suggest":{"total":0,"time_in_millis":0,"current":0},"request_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0},"recovery":{"current_as_source":0,"current_as_target":0,"throttle_time_in_millis":0}},"os":{"timestamp":1441124851832,"load_average":2.38037109375,"mem":{"total_in_bytes":8589934592,"free_in_bytes":33062912,"used_in_bytes":8556871680,"free_percent":0,"used_percent":100},"swap":{"total_in_bytes":2147483648,"free_in_bytes":1561591808,"used_in_bytes":585891840}},"process":{"timestamp":1441124851832,"open_file_descriptors":263,"max_file_descriptors":10240,"cpu":{"percent":0,"total_in_millis":15998},"mem":{"total_virtual_in_bytes":5324689408}},"jvm":{"timestamp":1441124851832,"uptime_in_millis":225541,"mem":{"heap_used_in_bytes":28523216,"heap_used_percent":2,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":54546016,"non_heap_committed_in_bytes":55439360,"pools":{"young":{"used_in_bytes":6849672,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":7245656,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":14427888,"max_in_bytes":715849728,"peak_used_in_bytes":14427888,"peak_max_in_bytes":715849728}}},"threads":{"count":102,"peak_count":103},"gc":{"collectors":{"young":{"collection_count":6,"collection_time_in_millis":130},"old":{"collection_count":1,"collection_time_in_millis":16}}},"buffer_pools":{"direct":{"count":159,"used_in_bytes":27289655,"total_capacity_in_bytes":27289655},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}},"classes":{"current_loaded_count":7390,"total_loaded_count":7390,"total_unloaded_count":0}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_started":{"threads":13,"queue":0,"active":0,"rejected":0,"largest":13,"completed":13},"listener":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":13},"index":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":6},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":5,"completed":146},"warmer":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":45},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_store":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":9},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":109},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"fs":{"timestamp":1441124851833,"total":{"total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032},"data":[{"path":"/Users/leonardo.menezes/Downloads/elastic/elasticsearch-2.0.0-beta1/data/elasticsearch/nodes/0","mount":"/ (/dev/disk1)","type":"hfs","total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032}]},"transport":{"server_open":13,"rx_count":691,"rx_size_in_bytes":69171,"tx_count":686,"tx_size_in_bytes":128848},"http":{"current_open":1,"total_opened":23},"breakers":{"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}},"script":{"compilations":0,"cache_evictions":0}}}}');
  var settings = JSON.parse('{"foobar":{"settings":{"index":{"creation_date":"1441124850075","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"2","number_of_replicas":"0","uuid":"esZgCJ-_Qhe-Tb7csEeQzg","version":{"created":"2000001"}}}},"foobaz":{"settings":{"index":{"creation_date":"1441124850198","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"1","number_of_replicas":"2","uuid":"Zk_peWimSxON61GOKR6jzg","version":{"created":"2000001"}}}}}');
  var aliases = JSON.parse('{"foobar":{"aliases":{}},"foobaz":{"aliases":{}}}');
  var health = JSON.parse('{"cluster_name":"elasticsearch","status":"yellow","timed_out":false,"number_of_nodes":2,"number_of_data_nodes":2,"active_primary_shards":3,"active_shards":4,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":1,"delayed_unassigned_shards":0,"number_of_pending_tasks":0,"number_of_in_flight_fetch":0,"task_max_waiting_in_queue_millis":0,"active_shards_percent_as_number":80.0}');
  var nodes = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"name":"Hypnotia","transport_address":"127.0.0.1:9301","host":"127.0.0.1","ip":"127.0.0.1","version":"2.0.0-beta1","build":"bfa3e47","http_address":"127.0.0.1:9201","os":{"refresh_interval_in_millis":1000,"available_processors":8},"jvm":{"pid":42400,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1441124681550,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}},"4e_2czvrSBm13l35VIcN4Q":{"name":"Polaris","transport_address":"127.0.0.1:9300","host":"127.0.0.1","ip":"127.0.0.1","version":"2.0.0-beta1","build":"bfa3e47","http_address":"127.0.0.1:9200","os":{"refresh_interval_in_millis":1000,"name":"Mac OS X","arch":"x86_64","version":"10.10.5","available_processors":8},"jvm":{"pid":42366,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1441124626350,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}}}}');
  var cluster = new Cluster(health, state, indexStats, nodeStats, settings, aliases, nodes);

  var size_pattern = /\d+\.\d+\w{1,2}/;
  var number_pattern = /\d+/;

  // check clustercluster properties
  equal(cluster.num_docs, 8, "Number of documents");
  //equal(cluster.total_size == '16.49KB', "Checking total size");
  equal(cluster.unassigned_shards, 1, "Unassigned shards");
  equal(cluster.shards, 5, "Number of shards");
  equal(cluster.total_indices, 3, "Number of indices");
  var master_node = cluster.master_node;

  // index info
  ok(cluster.indices.length, 3, "Indices list length");

  var indices = cluster.indices;
  indices.forEach(function(index) {
    ok(index.state == 'open' || index.state == 'close',
        "Checking index state: [" + index.state + "]");
    if (index.state == 'open') {
      ok(number_pattern.test(index.size_in_bytes),
          "Checking primary size: [" + index.size_in_bytes + "]");
      ok(number_pattern.test(index.total_size_in_bytes),
          "Checking total size: [" + index.total_size_in_bytes + "]");
    }
    ok(number_pattern.test(index.num_docs),
        "Checking num docs: [" + index.num_docs + "]");
    ok(number_pattern.test(index.deleted_docs),
        "Checking deleted docs: [" + index.deleted_docs + "]");
    ok(index.name.length > 0, "Checking index name: [" + index.name + "]");
    ok(number_pattern.test(index.num_of_shards),
        "Checking number of shards: [" + index.num_of_shards + "]");
    ok(number_pattern.test(index.num_of_replicas),
        "Checking number of replicas: [" + index.num_of_replicas + "]");
    var node_ids = cluster.getNodes(true).map(function(node) {
      return node.id;
    });
    node_ids.forEach(function(node_id) {
      if (cluster.getShards(node_id, index.id) != null) {
        cluster.getShards(node_id, index.id).forEach(function(shard) {
          ok(shard.primary == true || shard.primary == false,
              "Checking primary status: [" + shard.primary + "]");
          equal(shard.node, node_id,
              "Shards should have referece to correct node");
          ok(shard.state == 'STARTED',
              "Shards should be started: [" + shard.state + "]");
        });
      }
    });

  });

  // check nodes
  var nodes = cluster.getNodes();
  equal(nodes.length, 2, "Unfiltered node list");
  var master_nodes = 0;
  nodes.forEach(function(node) {
    ok(number_pattern.test(node.disk_total_in_bytes),
        "Checking disk total [" + node.disk_total_in_bytes + "]");
    ok(number_pattern.test(node.disk_free_in_bytes),
        "Checking free disk [" + node.disk_free_in_bytes + "]");
    ok(node.disk_used_percent >= 0 && node.disk_used_percent <= 100,
        "Checking disk usage in percent [" + node.disk_used_percent + "]");
    ok(size_pattern.test(node.heap_used),
        "Checking node heap used [" + node.heap_used + "]");
    ok(size_pattern.test(node.heap_committed),
        "Checking node heap commited [" + node.heap_committed + "]");
    ok(size_pattern.test(node.heap_max),
        "Checking max heap size [" + node.heap_max + "]");
    ok(node.heap_used_percent >= 0 && node.heap_used_percent <= 100,
        "Checking heap used percent [" + node.heap_used_percent + "]");
    ok(node.cpu >= 0 && number_pattern.test(node.cpu),
        "Checking process cpu [" + node.cpu + "]");
    equal(node.id.length, 22, "Checking node id length");
    equal(node.jvmVersion, '1.8.0_40', "Checking node jvm version");
    equal(node.elasticVersion, '2.0.0-beta1', "Checking node es version");
    if (node.current_master) {
      master_nodes += 1;
      equal(master_node, node.id, "Checking current master");
    }
  });
  equal(master_nodes, 1, "There should be exactly one master node");
});

test("computing cluster changes", function() {
  var state = JSON.parse('{"cluster_name":"elasticsearch","master_node":"4e_2czvrSBm13l35VIcN4Q","blocks":{"indices":{"qux":{"4":{"description":"index closed","retryable":false,"levels":["read","write"]}}}},"nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"name":"Hypnotia","transport_address":"127.0.0.1:9301","attributes":{}},"4e_2czvrSBm13l35VIcN4Q":{"name":"Polaris","transport_address":"127.0.0.1:9300","attributes":{}}},"routing_table":{"indices":{"foobar":{"shards":{"1":[{"state":"STARTED","primary":true,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":1,"index":"foobar","version":2,"allocation_id":{"id":"q58EfCH4RlibTgWihHvwXA"}}],"0":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobar","version":2,"allocation_id":{"id":"Ok00ZJXCQ8qptWzbg0tNiA"}}]}},"foobaz":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"u50tX7tLSGy2VJj9YNHzGg"}},{"state":"STARTED","primary":false,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"BZc-GDVcRpGjjTj6nTscXw"}},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz","version":3,"unassigned_info":{"reason":"INDEX_CREATED","at":"2015-09-01T16:27:30.208Z"}}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz","version":3,"unassigned_info":{"reason":"INDEX_CREATED","at":"2015-09-01T16:27:30.208Z"}}],"nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobar","version":2,"allocation_id":{"id":"Ok00ZJXCQ8qptWzbg0tNiA"}},{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"u50tX7tLSGy2VJj9YNHzGg"}}],"4e_2czvrSBm13l35VIcN4Q":[{"state":"STARTED","primary":true,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":1,"index":"foobar","version":2,"allocation_id":{"id":"q58EfCH4RlibTgWihHvwXA"}},{"state":"STARTED","primary":false,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"BZc-GDVcRpGjjTj6nTscXw"}}]}}}');
  var indexStats = JSON.parse('{"_shards":{"total":5,"successful":4,"failed":0},"_all":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7243,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7370,"throttle_time_in_millis":0}}},"indices":{"foobar":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7116,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7116,"throttle_time_in_millis":0}}},"foobaz":{"primaries":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":127,"throttle_time_in_millis":0}},"total":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":254,"throttle_time_in_millis":0}}}}}');
  var nodeStats = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"timestamp":1441124851828,"name":"Hypnotia","transport_address":"127.0.0.1:9301","host":"127.0.0.1","ip":["127.0.0.1:9301","NONE"],"indices":{"docs":{"count":2,"deleted":0},"store":{"size_in_bytes":3545,"throttle_time_in_millis":0},"indexing":{"index_total":2,"index_time_in_millis":42,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0,"scroll_total":0,"scroll_time_in_millis":0,"scroll_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0,"total_stopped_time_in_millis":0,"total_throttled_time_in_millis":0,"total_auto_throttle_in_bytes":293601280},"refresh":{"total":2,"total_time_in_millis":56},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":4},"query_cache":{"memory_size_in_bytes":0,"total_count":0,"hit_count":0,"miss_count":0,"cache_size":0,"cache_count":0,"evictions":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":3140,"terms_memory_in_bytes":2696,"stored_fields_memory_in_bytes":312,"term_vectors_memory_in_bytes":0,"norms_memory_in_bytes":40,"doc_values_memory_in_bytes":92,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":144},"translog":{"operations":1,"size_in_bytes":43},"suggest":{"total":0,"time_in_millis":0,"current":0},"request_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0},"recovery":{"current_as_source":0,"current_as_target":0,"throttle_time_in_millis":0}},"os":{"timestamp":1441124851833,"load_average":2.38037109375,"mem":{"total_in_bytes":8589934592,"free_in_bytes":33062912,"used_in_bytes":8556871680,"free_percent":0,"used_percent":100},"swap":{"total_in_bytes":2147483648,"free_in_bytes":1561591808,"used_in_bytes":585891840}},"process":{"timestamp":1441124851833,"open_file_descriptors":262,"max_file_descriptors":10240,"cpu":{"percent":0,"total_in_millis":13524},"mem":{"total_virtual_in_bytes":5296508928}},"jvm":{"timestamp":1441124851833,"uptime_in_millis":170342,"mem":{"heap_used_in_bytes":55240456,"heap_used_percent":5,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":52334240,"non_heap_committed_in_bytes":53141504,"pools":{"young":{"used_in_bytes":34679280,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":8756448,"max_in_bytes":35782656,"peak_used_in_bytes":8912888,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":11804728,"max_in_bytes":715849728,"peak_used_in_bytes":11804728,"peak_max_in_bytes":715849728}}},"threads":{"count":86,"peak_count":96},"gc":{"collectors":{"young":{"collection_count":5,"collection_time_in_millis":62},"old":{"collection_count":1,"collection_time_in_millis":16}}},"buffer_pools":{"direct":{"count":96,"used_in_bytes":15232813,"total_capacity_in_bytes":15232813},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_started":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":6},"listener":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":5,"completed":334},"warmer":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":40},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_store":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":9},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":69},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"fs":{"timestamp":1441124851834,"total":{"total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032},"data":[{"path":"/Users/leonardo.menezes/Downloads/elastic/elasticsearch-2.0.0-beta1/data/elasticsearch/nodes/1","mount":"/ (/dev/disk1)","type":"hfs","total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032}]},"transport":{"server_open":13,"rx_count":661,"rx_size_in_bytes":112203,"tx_count":656,"tx_size_in_bytes":63905},"http":{"current_open":0,"total_opened":0},"breakers":{"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}},"script":{"compilations":0,"cache_evictions":0}},"4e_2czvrSBm13l35VIcN4Q":{"timestamp":1441124851827,"name":"Polaris","transport_address":"127.0.0.1:9300","host":"127.0.0.1","ip":["127.0.0.1:9300","NONE"],"indices":{"docs":{"count":6,"deleted":0},"store":{"size_in_bytes":3825,"throttle_time_in_millis":0},"indexing":{"index_total":6,"index_time_in_millis":53,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0,"scroll_total":0,"scroll_time_in_millis":0,"scroll_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0,"total_stopped_time_in_millis":0,"total_throttled_time_in_millis":0,"total_auto_throttle_in_bytes":314572800},"refresh":{"total":2,"total_time_in_millis":64},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":7,"total_time_in_millis":2},"query_cache":{"memory_size_in_bytes":0,"total_count":0,"hit_count":0,"miss_count":0,"cache_size":0,"cache_count":0,"evictions":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":3140,"terms_memory_in_bytes":2696,"stored_fields_memory_in_bytes":312,"term_vectors_memory_in_bytes":0,"norms_memory_in_bytes":40,"doc_values_memory_in_bytes":92,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":72},"translog":{"operations":5,"size_in_bytes":43},"suggest":{"total":0,"time_in_millis":0,"current":0},"request_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0},"recovery":{"current_as_source":0,"current_as_target":0,"throttle_time_in_millis":0}},"os":{"timestamp":1441124851832,"load_average":2.38037109375,"mem":{"total_in_bytes":8589934592,"free_in_bytes":33062912,"used_in_bytes":8556871680,"free_percent":0,"used_percent":100},"swap":{"total_in_bytes":2147483648,"free_in_bytes":1561591808,"used_in_bytes":585891840}},"process":{"timestamp":1441124851832,"open_file_descriptors":263,"max_file_descriptors":10240,"cpu":{"percent":0,"total_in_millis":15998},"mem":{"total_virtual_in_bytes":5324689408}},"jvm":{"timestamp":1441124851832,"uptime_in_millis":225541,"mem":{"heap_used_in_bytes":28523216,"heap_used_percent":2,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":54546016,"non_heap_committed_in_bytes":55439360,"pools":{"young":{"used_in_bytes":6849672,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":7245656,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":14427888,"max_in_bytes":715849728,"peak_used_in_bytes":14427888,"peak_max_in_bytes":715849728}}},"threads":{"count":102,"peak_count":103},"gc":{"collectors":{"young":{"collection_count":6,"collection_time_in_millis":130},"old":{"collection_count":1,"collection_time_in_millis":16}}},"buffer_pools":{"direct":{"count":159,"used_in_bytes":27289655,"total_capacity_in_bytes":27289655},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}},"classes":{"current_loaded_count":7390,"total_loaded_count":7390,"total_unloaded_count":0}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_started":{"threads":13,"queue":0,"active":0,"rejected":0,"largest":13,"completed":13},"listener":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":13},"index":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":6},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":5,"completed":146},"warmer":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":45},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_store":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":9},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":109},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"fs":{"timestamp":1441124851833,"total":{"total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032},"data":[{"path":"/Users/leonardo.menezes/Downloads/elastic/elasticsearch-2.0.0-beta1/data/elasticsearch/nodes/0","mount":"/ (/dev/disk1)","type":"hfs","total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032}]},"transport":{"server_open":13,"rx_count":691,"rx_size_in_bytes":69171,"tx_count":686,"tx_size_in_bytes":128848},"http":{"current_open":1,"total_opened":23},"breakers":{"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}},"script":{"compilations":0,"cache_evictions":0}}}}');
  var settings = JSON.parse('{"foobar":{"settings":{"index":{"creation_date":"1441124850075","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"2","number_of_replicas":"0","uuid":"esZgCJ-_Qhe-Tb7csEeQzg","version":{"created":"2000001"}}}},"foobaz":{"settings":{"index":{"creation_date":"1441124850198","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"1","number_of_replicas":"2","uuid":"Zk_peWimSxON61GOKR6jzg","version":{"created":"2000001"}}}}}');
  var aliases = JSON.parse('{"foobar":{"aliases":{}},"foobaz":{"aliases":{}}}');
  var health = JSON.parse('{"cluster_name":"elasticsearch","status":"yellow","timed_out":false,"number_of_nodes":2,"number_of_data_nodes":2,"active_primary_shards":3,"active_shards":4,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":1,"delayed_unassigned_shards":0,"number_of_pending_tasks":0,"number_of_in_flight_fetch":0,"task_max_waiting_in_queue_millis":0,"active_shards_percent_as_number":80.0}');
  var nodes = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"name":"Hypnotia","transport_address":"127.0.0.1:9301","host":"127.0.0.1","ip":"127.0.0.1","version":"2.0.0-beta1","build":"bfa3e47","http_address":"127.0.0.1:9201","os":{"refresh_interval_in_millis":1000,"available_processors":8},"jvm":{"pid":42400,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1441124681550,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}},"4e_2czvrSBm13l35VIcN4Q":{"name":"Polaris","transport_address":"127.0.0.1:9300","host":"127.0.0.1","ip":"127.0.0.1","version":"2.0.0-beta1","build":"bfa3e47","http_address":"127.0.0.1:9200","os":{"refresh_interval_in_millis":1000,"name":"Mac OS X","arch":"x86_64","version":"10.10.5","available_processors":8},"jvm":{"pid":42366,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1441124626350,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}}}}');
  var cluster = new Cluster(health, state, indexStats, nodeStats, settings, aliases, nodes);

  var state2 = JSON.parse('{"cluster_name":"elasticsearch","master_node":"4e_2czvrSBm13l35VIcN4F","blocks":{"indices":{"qux":{"4":{"description":"index closed","retryable":false,"levels":["read","write"]}}}},"nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"name":"Hypnotia","transport_address":"127.0.0.1:9301","attributes":{}},"4e_2czvrSBm13l35VIcN4F":{"name":"Polaris","transport_address":"127.0.0.1:9300","attributes":{}}},"routing_table":{"indices":{"foobar":{"shards":{"1":[{"state":"STARTED","primary":true,"node":"4e_2czvrSBm13l35VIcN4F","relocating_node":null,"shard":1,"index":"foobar","version":2,"allocation_id":{"id":"q58EfCH4RlibTgWihHvwXA"}}],"0":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobar","version":2,"allocation_id":{"id":"Ok00ZJXCQ8qptWzbg0tNiA"}}]}},"foobaz":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"u50tX7tLSGy2VJj9YNHzGg"}},{"state":"STARTED","primary":false,"node":"4e_2czvrSBm13l35VIcN4F","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"BZc-GDVcRpGjjTj6nTscXw"}},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz","version":3,"unassigned_info":{"reason":"INDEX_CREATED","at":"2015-09-01T16:27:30.208Z"}}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz","version":3,"unassigned_info":{"reason":"INDEX_CREATED","at":"2015-09-01T16:27:30.208Z"}}],"nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobar","version":2,"allocation_id":{"id":"Ok00ZJXCQ8qptWzbg0tNiA"}},{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"u50tX7tLSGy2VJj9YNHzGg"}}],"4e_2czvrSBm13l35VIcN4F":[{"state":"STARTED","primary":true,"node":"4e_2czvrSBm13l35VIcN4F","relocating_node":null,"shard":1,"index":"foobar","version":2,"allocation_id":{"id":"q58EfCH4RlibTgWihHvwXA"}},{"state":"STARTED","primary":false,"node":"4e_2czvrSBm13l35VIcN4F","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"BZc-GDVcRpGjjTj6nTscXw"}}]}}}');
  var indexStats2 = JSON.parse('{"_shards":{"total":5,"successful":4,"failed":0},"_all":{"primaries":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":8243,"throttle_time_in_millis":0}},"total":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":8370,"throttle_time_in_millis":0}}},"indices":{"foobar":{"primaries":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":7116,"throttle_time_in_millis":0}},"total":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":7116,"throttle_time_in_millis":0}}},"foobaz":{"primaries":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":127,"throttle_time_in_millis":0}},"total":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":254,"throttle_time_in_millis":0}}}}}');
  var nodeStats2 = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"timestamp":1441124851828,"name":"Hypnotia","transport_address":"127.0.0.1:9301","host":"127.0.0.1","ip":["127.0.0.1:9301","NONE"],"indices":{"docs":{"count":2,"deleted":0},"store":{"size_in_bytes":3545,"throttle_time_in_millis":0},"indexing":{"index_total":2,"index_time_in_millis":42,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0,"scroll_total":0,"scroll_time_in_millis":0,"scroll_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0,"total_stopped_time_in_millis":0,"total_throttled_time_in_millis":0,"total_auto_throttle_in_bytes":293601280},"refresh":{"total":2,"total_time_in_millis":56},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":4},"query_cache":{"memory_size_in_bytes":0,"total_count":0,"hit_count":0,"miss_count":0,"cache_size":0,"cache_count":0,"evictions":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":3140,"terms_memory_in_bytes":2696,"stored_fields_memory_in_bytes":312,"term_vectors_memory_in_bytes":0,"norms_memory_in_bytes":40,"doc_values_memory_in_bytes":92,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":144},"translog":{"operations":1,"size_in_bytes":43},"suggest":{"total":0,"time_in_millis":0,"current":0},"request_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0},"recovery":{"current_as_source":0,"current_as_target":0,"throttle_time_in_millis":0}},"os":{"timestamp":1441124851833,"load_average":2.38037109375,"mem":{"total_in_bytes":8589934592,"free_in_bytes":33062912,"used_in_bytes":8556871680,"free_percent":0,"used_percent":100},"swap":{"total_in_bytes":2147483648,"free_in_bytes":1561591808,"used_in_bytes":585891840}},"process":{"timestamp":1441124851833,"open_file_descriptors":262,"max_file_descriptors":10240,"cpu":{"percent":0,"total_in_millis":13524},"mem":{"total_virtual_in_bytes":5296508928}},"jvm":{"timestamp":1441124851833,"uptime_in_millis":170342,"mem":{"heap_used_in_bytes":55240456,"heap_used_percent":5,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":52334240,"non_heap_committed_in_bytes":53141504,"pools":{"young":{"used_in_bytes":34679280,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":8756448,"max_in_bytes":35782656,"peak_used_in_bytes":8912888,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":11804728,"max_in_bytes":715849728,"peak_used_in_bytes":11804728,"peak_max_in_bytes":715849728}}},"threads":{"count":86,"peak_count":96},"gc":{"collectors":{"young":{"collection_count":5,"collection_time_in_millis":62},"old":{"collection_count":1,"collection_time_in_millis":16}}},"buffer_pools":{"direct":{"count":96,"used_in_bytes":15232813,"total_capacity_in_bytes":15232813},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_started":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":6},"listener":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":5,"completed":334},"warmer":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":40},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_store":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":9},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":69},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"fs":{"timestamp":1441124851834,"total":{"total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032},"data":[{"path":"/Users/leonardo.menezes/Downloads/elastic/elasticsearch-2.0.0-beta1/data/elasticsearch/nodes/1","mount":"/ (/dev/disk1)","type":"hfs","total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032}]},"transport":{"server_open":13,"rx_count":661,"rx_size_in_bytes":112203,"tx_count":656,"tx_size_in_bytes":63905},"http":{"current_open":0,"total_opened":0},"breakers":{"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}},"script":{"compilations":0,"cache_evictions":0}},"4e_2czvrSBm13l35VIcN4F":{"timestamp":1441124851827,"name":"Polaris","transport_address":"127.0.0.1:9300","host":"127.0.0.1","ip":["127.0.0.1:9300","NONE"],"indices":{"docs":{"count":5,"deleted":0},"store":{"size_in_bytes":3825,"throttle_time_in_millis":0},"indexing":{"index_total":6,"index_time_in_millis":53,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0,"scroll_total":0,"scroll_time_in_millis":0,"scroll_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0,"total_stopped_time_in_millis":0,"total_throttled_time_in_millis":0,"total_auto_throttle_in_bytes":314572800},"refresh":{"total":2,"total_time_in_millis":64},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":7,"total_time_in_millis":2},"query_cache":{"memory_size_in_bytes":0,"total_count":0,"hit_count":0,"miss_count":0,"cache_size":0,"cache_count":0,"evictions":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":3140,"terms_memory_in_bytes":2696,"stored_fields_memory_in_bytes":312,"term_vectors_memory_in_bytes":0,"norms_memory_in_bytes":40,"doc_values_memory_in_bytes":92,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":72},"translog":{"operations":5,"size_in_bytes":43},"suggest":{"total":0,"time_in_millis":0,"current":0},"request_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0},"recovery":{"current_as_source":0,"current_as_target":0,"throttle_time_in_millis":0}},"os":{"timestamp":1441124851832,"load_average":2.38037109375,"mem":{"total_in_bytes":8589934592,"free_in_bytes":33062912,"used_in_bytes":8556871680,"free_percent":0,"used_percent":100},"swap":{"total_in_bytes":2147483648,"free_in_bytes":1561591808,"used_in_bytes":585891840}},"process":{"timestamp":1441124851832,"open_file_descriptors":263,"max_file_descriptors":10240,"cpu":{"percent":0,"total_in_millis":15998},"mem":{"total_virtual_in_bytes":5324689408}},"jvm":{"timestamp":1441124851832,"uptime_in_millis":225541,"mem":{"heap_used_in_bytes":28523216,"heap_used_percent":2,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":54546016,"non_heap_committed_in_bytes":55439360,"pools":{"young":{"used_in_bytes":6849672,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":7245656,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":14427888,"max_in_bytes":715849728,"peak_used_in_bytes":14427888,"peak_max_in_bytes":715849728}}},"threads":{"count":102,"peak_count":103},"gc":{"collectors":{"young":{"collection_count":6,"collection_time_in_millis":130},"old":{"collection_count":1,"collection_time_in_millis":16}}},"buffer_pools":{"direct":{"count":159,"used_in_bytes":27289655,"total_capacity_in_bytes":27289655},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}},"classes":{"current_loaded_count":7390,"total_loaded_count":7390,"total_unloaded_count":0}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_started":{"threads":13,"queue":0,"active":0,"rejected":0,"largest":13,"completed":13},"listener":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":13},"index":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":6},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":5,"completed":146},"warmer":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":45},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_store":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":9},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":109},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"fs":{"timestamp":1441124851833,"total":{"total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032},"data":[{"path":"/Users/leonardo.menezes/Downloads/elastic/elasticsearch-2.0.0-beta1/data/elasticsearch/nodes/0","mount":"/ (/dev/disk1)","type":"hfs","total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032}]},"transport":{"server_open":13,"rx_count":691,"rx_size_in_bytes":69171,"tx_count":686,"tx_size_in_bytes":128848},"http":{"current_open":1,"total_opened":23},"breakers":{"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}},"script":{"compilations":0,"cache_evictions":0}}}}');
  var settings2 = JSON.parse('{"foobar":{"settings":{"index":{"creation_date":"1441124850075","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"2","number_of_replicas":"0","uuid":"esZgCJ-_Qhe-Tb7csEeQzg","version":{"created":"2000001"}}}},"foobaz":{"settings":{"index":{"creation_date":"1441124850198","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"1","number_of_replicas":"2","uuid":"Zk_peWimSxON61GOKR6jzg","version":{"created":"2000001"}}}}}');
  var aliases2 = JSON.parse('{"foobar":{"aliases":{}},"foobaz":{"aliases":{}}}');
  var health2 = JSON.parse('{"cluster_name":"elasticsearch","status":"yellow","timed_out":false,"number_of_nodes":2,"number_of_data_nodes":2,"active_primary_shards":3,"active_shards":4,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":1,"delayed_unassigned_shards":0,"number_of_pending_tasks":0,"number_of_in_flight_fetch":0,"task_max_waiting_in_queue_millis":0,"active_shards_percent_as_number":80.0}');
  var nodes2 = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"name":"Hypnotia","transport_address":"127.0.0.1:9301","host":"127.0.0.1","ip":"127.0.0.1","version":"2.0.0-beta1","build":"bfa3e47","http_address":"127.0.0.1:9201","os":{"refresh_interval_in_millis":1000,"available_processors":8},"jvm":{"pid":42400,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1441124681550,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}},"4e_2czvrSBm13l35VIcN4F":{"name":"Polaris","transport_address":"127.0.0.1:9300","host":"127.0.0.1","ip":"127.0.0.1","version":"2.0.0-beta1","build":"bfa3e47","http_address":"127.0.0.1:9200","os":{"refresh_interval_in_millis":1000,"name":"Mac OS X","arch":"x86_64","version":"10.10.5","available_processors":8},"jvm":{"pid":42366,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1441124626350,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}}}}');
  var cluster2 = new Cluster(health2, state2, indexStats2, nodeStats2, settings2, aliases2, nodes2);

  cluster2.computeChanges(cluster);

  ok(cluster2.changes.getDocDelta() == -1, "Checking document delta ");
  ok(cluster2.changes.getDataDelta() == 1000,
      "" + cluster2.changes.getDataDelta());
  ok(cluster2.changes.absDataDelta() == "1000.00b",
      "" + cluster2.changes.absDataDelta());

  ok(cluster2.changes.nodeJoins.length == 1, "checking joinng nodes");
  ok(cluster2.changes.nodeLeaves.length == 1, "checking disconnecting nodes");

  ok(cluster2.changes.nodeJoins[0].id == "4e_2czvrSBm13l35VIcN4F",
      "checking node identity");
  ok(cluster2.changes.nodeLeaves[0].id == "4e_2czvrSBm13l35VIcN4Q",
      "checking node identity");
});

test("computing cluster changes on two different clusters should yield no changes",
    function() {
      var state = JSON.parse('{"cluster_name":"elasticsearch","master_node":"4e_2czvrSBm13l35VIcN4Q","blocks":{"indices":{"qux":{"4":{"description":"index closed","retryable":false,"levels":["read","write"]}}}},"nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"name":"Hypnotia","transport_address":"127.0.0.1:9301","attributes":{}},"4e_2czvrSBm13l35VIcN4Q":{"name":"Polaris","transport_address":"127.0.0.1:9300","attributes":{}}},"routing_table":{"indices":{"foobar":{"shards":{"1":[{"state":"STARTED","primary":true,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":1,"index":"foobar","version":2,"allocation_id":{"id":"q58EfCH4RlibTgWihHvwXA"}}],"0":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobar","version":2,"allocation_id":{"id":"Ok00ZJXCQ8qptWzbg0tNiA"}}]}},"foobaz":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"u50tX7tLSGy2VJj9YNHzGg"}},{"state":"STARTED","primary":false,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"BZc-GDVcRpGjjTj6nTscXw"}},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz","version":3,"unassigned_info":{"reason":"INDEX_CREATED","at":"2015-09-01T16:27:30.208Z"}}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz","version":3,"unassigned_info":{"reason":"INDEX_CREATED","at":"2015-09-01T16:27:30.208Z"}}],"nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobar","version":2,"allocation_id":{"id":"Ok00ZJXCQ8qptWzbg0tNiA"}},{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"u50tX7tLSGy2VJj9YNHzGg"}}],"4e_2czvrSBm13l35VIcN4Q":[{"state":"STARTED","primary":true,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":1,"index":"foobar","version":2,"allocation_id":{"id":"q58EfCH4RlibTgWihHvwXA"}},{"state":"STARTED","primary":false,"node":"4e_2czvrSBm13l35VIcN4Q","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"BZc-GDVcRpGjjTj6nTscXw"}}]}}}');
      var indexStats = JSON.parse('{"_shards":{"total":5,"successful":4,"failed":0},"_all":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7243,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7370,"throttle_time_in_millis":0}}},"indices":{"foobar":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7116,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7116,"throttle_time_in_millis":0}}},"foobaz":{"primaries":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":127,"throttle_time_in_millis":0}},"total":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":254,"throttle_time_in_millis":0}}}}}');
      var nodeStats = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"timestamp":1441124851828,"name":"Hypnotia","transport_address":"127.0.0.1:9301","host":"127.0.0.1","ip":["127.0.0.1:9301","NONE"],"indices":{"docs":{"count":2,"deleted":0},"store":{"size_in_bytes":3545,"throttle_time_in_millis":0},"indexing":{"index_total":2,"index_time_in_millis":42,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0,"scroll_total":0,"scroll_time_in_millis":0,"scroll_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0,"total_stopped_time_in_millis":0,"total_throttled_time_in_millis":0,"total_auto_throttle_in_bytes":293601280},"refresh":{"total":2,"total_time_in_millis":56},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":4},"query_cache":{"memory_size_in_bytes":0,"total_count":0,"hit_count":0,"miss_count":0,"cache_size":0,"cache_count":0,"evictions":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":3140,"terms_memory_in_bytes":2696,"stored_fields_memory_in_bytes":312,"term_vectors_memory_in_bytes":0,"norms_memory_in_bytes":40,"doc_values_memory_in_bytes":92,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":144},"translog":{"operations":1,"size_in_bytes":43},"suggest":{"total":0,"time_in_millis":0,"current":0},"request_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0},"recovery":{"current_as_source":0,"current_as_target":0,"throttle_time_in_millis":0}},"os":{"timestamp":1441124851833,"load_average":2.38037109375,"mem":{"total_in_bytes":8589934592,"free_in_bytes":33062912,"used_in_bytes":8556871680,"free_percent":0,"used_percent":100},"swap":{"total_in_bytes":2147483648,"free_in_bytes":1561591808,"used_in_bytes":585891840}},"process":{"timestamp":1441124851833,"open_file_descriptors":262,"max_file_descriptors":10240,"cpu":{"percent":0,"total_in_millis":13524},"mem":{"total_virtual_in_bytes":5296508928}},"jvm":{"timestamp":1441124851833,"uptime_in_millis":170342,"mem":{"heap_used_in_bytes":55240456,"heap_used_percent":5,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":52334240,"non_heap_committed_in_bytes":53141504,"pools":{"young":{"used_in_bytes":34679280,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":8756448,"max_in_bytes":35782656,"peak_used_in_bytes":8912888,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":11804728,"max_in_bytes":715849728,"peak_used_in_bytes":11804728,"peak_max_in_bytes":715849728}}},"threads":{"count":86,"peak_count":96},"gc":{"collectors":{"young":{"collection_count":5,"collection_time_in_millis":62},"old":{"collection_count":1,"collection_time_in_millis":16}}},"buffer_pools":{"direct":{"count":96,"used_in_bytes":15232813,"total_capacity_in_bytes":15232813},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_started":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":6},"listener":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":5,"completed":334},"warmer":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":40},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_store":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":9},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":69},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"fs":{"timestamp":1441124851834,"total":{"total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032},"data":[{"path":"/Users/leonardo.menezes/Downloads/elastic/elasticsearch-2.0.0-beta1/data/elasticsearch/nodes/1","mount":"/ (/dev/disk1)","type":"hfs","total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032}]},"transport":{"server_open":13,"rx_count":661,"rx_size_in_bytes":112203,"tx_count":656,"tx_size_in_bytes":63905},"http":{"current_open":0,"total_opened":0},"breakers":{"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}},"script":{"compilations":0,"cache_evictions":0}},"4e_2czvrSBm13l35VIcN4Q":{"timestamp":1441124851827,"name":"Polaris","transport_address":"127.0.0.1:9300","host":"127.0.0.1","ip":["127.0.0.1:9300","NONE"],"indices":{"docs":{"count":6,"deleted":0},"store":{"size_in_bytes":3825,"throttle_time_in_millis":0},"indexing":{"index_total":6,"index_time_in_millis":53,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0,"scroll_total":0,"scroll_time_in_millis":0,"scroll_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0,"total_stopped_time_in_millis":0,"total_throttled_time_in_millis":0,"total_auto_throttle_in_bytes":314572800},"refresh":{"total":2,"total_time_in_millis":64},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":7,"total_time_in_millis":2},"query_cache":{"memory_size_in_bytes":0,"total_count":0,"hit_count":0,"miss_count":0,"cache_size":0,"cache_count":0,"evictions":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":3140,"terms_memory_in_bytes":2696,"stored_fields_memory_in_bytes":312,"term_vectors_memory_in_bytes":0,"norms_memory_in_bytes":40,"doc_values_memory_in_bytes":92,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":72},"translog":{"operations":5,"size_in_bytes":43},"suggest":{"total":0,"time_in_millis":0,"current":0},"request_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0},"recovery":{"current_as_source":0,"current_as_target":0,"throttle_time_in_millis":0}},"os":{"timestamp":1441124851832,"load_average":2.38037109375,"mem":{"total_in_bytes":8589934592,"free_in_bytes":33062912,"used_in_bytes":8556871680,"free_percent":0,"used_percent":100},"swap":{"total_in_bytes":2147483648,"free_in_bytes":1561591808,"used_in_bytes":585891840}},"process":{"timestamp":1441124851832,"open_file_descriptors":263,"max_file_descriptors":10240,"cpu":{"percent":0,"total_in_millis":15998},"mem":{"total_virtual_in_bytes":5324689408}},"jvm":{"timestamp":1441124851832,"uptime_in_millis":225541,"mem":{"heap_used_in_bytes":28523216,"heap_used_percent":2,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":54546016,"non_heap_committed_in_bytes":55439360,"pools":{"young":{"used_in_bytes":6849672,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":7245656,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":14427888,"max_in_bytes":715849728,"peak_used_in_bytes":14427888,"peak_max_in_bytes":715849728}}},"threads":{"count":102,"peak_count":103},"gc":{"collectors":{"young":{"collection_count":6,"collection_time_in_millis":130},"old":{"collection_count":1,"collection_time_in_millis":16}}},"buffer_pools":{"direct":{"count":159,"used_in_bytes":27289655,"total_capacity_in_bytes":27289655},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}},"classes":{"current_loaded_count":7390,"total_loaded_count":7390,"total_unloaded_count":0}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_started":{"threads":13,"queue":0,"active":0,"rejected":0,"largest":13,"completed":13},"listener":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":13},"index":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":6},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":5,"completed":146},"warmer":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":45},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_store":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":9},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":109},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"fs":{"timestamp":1441124851833,"total":{"total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032},"data":[{"path":"/Users/leonardo.menezes/Downloads/elastic/elasticsearch-2.0.0-beta1/data/elasticsearch/nodes/0","mount":"/ (/dev/disk1)","type":"hfs","total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032}]},"transport":{"server_open":13,"rx_count":691,"rx_size_in_bytes":69171,"tx_count":686,"tx_size_in_bytes":128848},"http":{"current_open":1,"total_opened":23},"breakers":{"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}},"script":{"compilations":0,"cache_evictions":0}}}}');
      var settings = JSON.parse('{"foobar":{"settings":{"index":{"creation_date":"1441124850075","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"2","number_of_replicas":"0","uuid":"esZgCJ-_Qhe-Tb7csEeQzg","version":{"created":"2000001"}}}},"foobaz":{"settings":{"index":{"creation_date":"1441124850198","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"1","number_of_replicas":"2","uuid":"Zk_peWimSxON61GOKR6jzg","version":{"created":"2000001"}}}}}');
      var aliases = JSON.parse('{"foobar":{"aliases":{}},"foobaz":{"aliases":{}}}');
      var health = JSON.parse('{"cluster_name":"elasticsearch","status":"yellow","timed_out":false,"number_of_nodes":2,"number_of_data_nodes":2,"active_primary_shards":3,"active_shards":4,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":1,"delayed_unassigned_shards":0,"number_of_pending_tasks":0,"number_of_in_flight_fetch":0,"task_max_waiting_in_queue_millis":0,"active_shards_percent_as_number":80.0}');
      var nodes = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"name":"Hypnotia","transport_address":"127.0.0.1:9301","host":"127.0.0.1","ip":"127.0.0.1","version":"2.0.0-beta1","build":"bfa3e47","http_address":"127.0.0.1:9201","os":{"refresh_interval_in_millis":1000,"available_processors":8},"jvm":{"pid":42400,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1441124681550,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}},"4e_2czvrSBm13l35VIcN4Q":{"name":"Polaris","transport_address":"127.0.0.1:9300","host":"127.0.0.1","ip":"127.0.0.1","version":"2.0.0-beta1","build":"bfa3e47","http_address":"127.0.0.1:9200","os":{"refresh_interval_in_millis":1000,"name":"Mac OS X","arch":"x86_64","version":"10.10.5","available_processors":8},"jvm":{"pid":42366,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1441124626350,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}}}}');
      var cluster = new Cluster(health, state, indexStats, nodeStats, settings, aliases, nodes);

      var state2 = JSON.parse('{"cluster_name":"elasticsearch2","master_node":"4e_2czvrSBm13l35VIcN4F","blocks":{"indices":{"qux":{"4":{"description":"index closed","retryable":false,"levels":["read","write"]}}}},"nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"name":"Hypnotia","transport_address":"127.0.0.1:9301","attributes":{}},"4e_2czvrSBm13l35VIcN4F":{"name":"Polaris","transport_address":"127.0.0.1:9300","attributes":{}}},"routing_table":{"indices":{"foobar":{"shards":{"1":[{"state":"STARTED","primary":true,"node":"4e_2czvrSBm13l35VIcN4F","relocating_node":null,"shard":1,"index":"foobar","version":2,"allocation_id":{"id":"q58EfCH4RlibTgWihHvwXA"}}],"0":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobar","version":2,"allocation_id":{"id":"Ok00ZJXCQ8qptWzbg0tNiA"}}]}},"foobaz":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"u50tX7tLSGy2VJj9YNHzGg"}},{"state":"STARTED","primary":false,"node":"4e_2czvrSBm13l35VIcN4F","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"BZc-GDVcRpGjjTj6nTscXw"}},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz","version":3,"unassigned_info":{"reason":"INDEX_CREATED","at":"2015-09-01T16:27:30.208Z"}}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz","version":3,"unassigned_info":{"reason":"INDEX_CREATED","at":"2015-09-01T16:27:30.208Z"}}],"nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":[{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobar","version":2,"allocation_id":{"id":"Ok00ZJXCQ8qptWzbg0tNiA"}},{"state":"STARTED","primary":true,"node":"CuZMv5l3SgOnxoDNZ7UfKw","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"u50tX7tLSGy2VJj9YNHzGg"}}],"4e_2czvrSBm13l35VIcN4F":[{"state":"STARTED","primary":true,"node":"4e_2czvrSBm13l35VIcN4F","relocating_node":null,"shard":1,"index":"foobar","version":2,"allocation_id":{"id":"q58EfCH4RlibTgWihHvwXA"}},{"state":"STARTED","primary":false,"node":"4e_2czvrSBm13l35VIcN4F","relocating_node":null,"shard":0,"index":"foobaz","version":3,"allocation_id":{"id":"BZc-GDVcRpGjjTj6nTscXw"}}]}}}');
      var indexStats2 = JSON.parse('{"_shards":{"total":5,"successful":4,"failed":0},"_all":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7243,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7370,"throttle_time_in_millis":0}}},"indices":{"foobar":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7116,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":7116,"throttle_time_in_millis":0}}},"foobaz":{"primaries":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":127,"throttle_time_in_millis":0}},"total":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":254,"throttle_time_in_millis":0}}}}}');
      var nodeStats2 = JSON.parse('{"cluster_name":"elasticsearch2","nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"timestamp":1441124851828,"name":"Hypnotia","transport_address":"127.0.0.1:9301","host":"127.0.0.1","ip":["127.0.0.1:9301","NONE"],"indices":{"docs":{"count":2,"deleted":0},"store":{"size_in_bytes":3545,"throttle_time_in_millis":0},"indexing":{"index_total":2,"index_time_in_millis":42,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0,"scroll_total":0,"scroll_time_in_millis":0,"scroll_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0,"total_stopped_time_in_millis":0,"total_throttled_time_in_millis":0,"total_auto_throttle_in_bytes":293601280},"refresh":{"total":2,"total_time_in_millis":56},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":4},"query_cache":{"memory_size_in_bytes":0,"total_count":0,"hit_count":0,"miss_count":0,"cache_size":0,"cache_count":0,"evictions":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":3140,"terms_memory_in_bytes":2696,"stored_fields_memory_in_bytes":312,"term_vectors_memory_in_bytes":0,"norms_memory_in_bytes":40,"doc_values_memory_in_bytes":92,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":144},"translog":{"operations":1,"size_in_bytes":43},"suggest":{"total":0,"time_in_millis":0,"current":0},"request_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0},"recovery":{"current_as_source":0,"current_as_target":0,"throttle_time_in_millis":0}},"os":{"timestamp":1441124851833,"load_average":2.38037109375,"mem":{"total_in_bytes":8589934592,"free_in_bytes":33062912,"used_in_bytes":8556871680,"free_percent":0,"used_percent":100},"swap":{"total_in_bytes":2147483648,"free_in_bytes":1561591808,"used_in_bytes":585891840}},"process":{"timestamp":1441124851833,"open_file_descriptors":262,"max_file_descriptors":10240,"cpu":{"percent":0,"total_in_millis":13524},"mem":{"total_virtual_in_bytes":5296508928}},"jvm":{"timestamp":1441124851833,"uptime_in_millis":170342,"mem":{"heap_used_in_bytes":55240456,"heap_used_percent":5,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":52334240,"non_heap_committed_in_bytes":53141504,"pools":{"young":{"used_in_bytes":34679280,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":8756448,"max_in_bytes":35782656,"peak_used_in_bytes":8912888,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":11804728,"max_in_bytes":715849728,"peak_used_in_bytes":11804728,"peak_max_in_bytes":715849728}}},"threads":{"count":86,"peak_count":96},"gc":{"collectors":{"young":{"collection_count":5,"collection_time_in_millis":62},"old":{"collection_count":1,"collection_time_in_millis":16}}},"buffer_pools":{"direct":{"count":96,"used_in_bytes":15232813,"total_capacity_in_bytes":15232813},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_started":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":6},"listener":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":5,"completed":334},"warmer":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":40},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_store":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":9},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":69},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"fs":{"timestamp":1441124851834,"total":{"total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032},"data":[{"path":"/Users/leonardo.menezes/Downloads/elastic/elasticsearch-2.0.0-beta1/data/elasticsearch/nodes/1","mount":"/ (/dev/disk1)","type":"hfs","total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032}]},"transport":{"server_open":13,"rx_count":661,"rx_size_in_bytes":112203,"tx_count":656,"tx_size_in_bytes":63905},"http":{"current_open":0,"total_opened":0},"breakers":{"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}},"script":{"compilations":0,"cache_evictions":0}},"4e_2czvrSBm13l35VIcN4F":{"timestamp":1441124851827,"name":"Polaris","transport_address":"127.0.0.1:9300","host":"127.0.0.1","ip":["127.0.0.1:9300","NONE"],"indices":{"docs":{"count":6,"deleted":0},"store":{"size_in_bytes":3825,"throttle_time_in_millis":0},"indexing":{"index_total":6,"index_time_in_millis":53,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0,"scroll_total":0,"scroll_time_in_millis":0,"scroll_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0,"total_stopped_time_in_millis":0,"total_throttled_time_in_millis":0,"total_auto_throttle_in_bytes":314572800},"refresh":{"total":2,"total_time_in_millis":64},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":7,"total_time_in_millis":2},"query_cache":{"memory_size_in_bytes":0,"total_count":0,"hit_count":0,"miss_count":0,"cache_size":0,"cache_count":0,"evictions":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":3140,"terms_memory_in_bytes":2696,"stored_fields_memory_in_bytes":312,"term_vectors_memory_in_bytes":0,"norms_memory_in_bytes":40,"doc_values_memory_in_bytes":92,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":72},"translog":{"operations":5,"size_in_bytes":43},"suggest":{"total":0,"time_in_millis":0,"current":0},"request_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0},"recovery":{"current_as_source":0,"current_as_target":0,"throttle_time_in_millis":0}},"os":{"timestamp":1441124851832,"load_average":2.38037109375,"mem":{"total_in_bytes":8589934592,"free_in_bytes":33062912,"used_in_bytes":8556871680,"free_percent":0,"used_percent":100},"swap":{"total_in_bytes":2147483648,"free_in_bytes":1561591808,"used_in_bytes":585891840}},"process":{"timestamp":1441124851832,"open_file_descriptors":263,"max_file_descriptors":10240,"cpu":{"percent":0,"total_in_millis":15998},"mem":{"total_virtual_in_bytes":5324689408}},"jvm":{"timestamp":1441124851832,"uptime_in_millis":225541,"mem":{"heap_used_in_bytes":28523216,"heap_used_percent":2,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":54546016,"non_heap_committed_in_bytes":55439360,"pools":{"young":{"used_in_bytes":6849672,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":7245656,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":14427888,"max_in_bytes":715849728,"peak_used_in_bytes":14427888,"peak_max_in_bytes":715849728}}},"threads":{"count":102,"peak_count":103},"gc":{"collectors":{"young":{"collection_count":6,"collection_time_in_millis":130},"old":{"collection_count":1,"collection_time_in_millis":16}}},"buffer_pools":{"direct":{"count":159,"used_in_bytes":27289655,"total_capacity_in_bytes":27289655},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}},"classes":{"current_loaded_count":7390,"total_loaded_count":7390,"total_unloaded_count":0}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_started":{"threads":13,"queue":0,"active":0,"rejected":0,"largest":13,"completed":13},"listener":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":13},"index":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":6},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":5,"completed":146},"warmer":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":45},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"fetch_shard_store":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":9},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":109},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"fs":{"timestamp":1441124851833,"total":{"total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032},"data":[{"path":"/Users/leonardo.menezes/Downloads/elastic/elasticsearch-2.0.0-beta1/data/elasticsearch/nodes/0","mount":"/ (/dev/disk1)","type":"hfs","total_in_bytes":249804886016,"free_in_bytes":72518316032,"available_in_bytes":72256172032}]},"transport":{"server_open":13,"rx_count":691,"rx_size_in_bytes":69171,"tx_count":686,"tx_size_in_bytes":128848},"http":{"current_open":1,"total_opened":23},"breakers":{"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}},"script":{"compilations":0,"cache_evictions":0}}}}');
      var settings2 = JSON.parse('{"foobar":{"settings":{"index":{"creation_date":"1441124850075","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"2","number_of_replicas":"0","uuid":"esZgCJ-_Qhe-Tb7csEeQzg","version":{"created":"2000001"}}}},"foobaz":{"settings":{"index":{"creation_date":"1441124850198","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"1","number_of_replicas":"2","uuid":"Zk_peWimSxON61GOKR6jzg","version":{"created":"2000001"}}}}}');
      var aliases2 = JSON.parse('{"foobar":{"aliases":{}},"foobaz":{"aliases":{}}}');
      var health2 = JSON.parse('{"cluster_name":"elasticsearch2","status":"yellow","timed_out":false,"number_of_nodes":2,"number_of_data_nodes":2,"active_primary_shards":3,"active_shards":4,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":1,"delayed_unassigned_shards":0,"number_of_pending_tasks":0,"number_of_in_flight_fetch":0,"task_max_waiting_in_queue_millis":0,"active_shards_percent_as_number":80.0}');
      var nodes2 = JSON.parse('{"cluster_name":"elasticsearch2","nodes":{"CuZMv5l3SgOnxoDNZ7UfKw":{"name":"Hypnotia","transport_address":"127.0.0.1:9301","host":"127.0.0.1","ip":"127.0.0.1","version":"2.0.0-beta1","build":"bfa3e47","http_address":"127.0.0.1:9201","os":{"refresh_interval_in_millis":1000,"available_processors":8},"jvm":{"pid":42400,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1441124681550,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}},"4e_2czvrSBm13l35VIcN4F":{"name":"Polaris","transport_address":"127.0.0.1:9300","host":"127.0.0.1","ip":"127.0.0.1","version":"2.0.0-beta1","build":"bfa3e47","http_address":"127.0.0.1:9200","os":{"refresh_interval_in_millis":1000,"name":"Mac OS X","arch":"x86_64","version":"10.10.5","available_processors":8},"jvm":{"pid":42366,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1441124626350,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}}}}');
      var cluster2 = new Cluster(health2, state2, indexStats2, nodeStats2, settings2, aliases2, nodes2);

      cluster2.computeChanges(cluster);
      ok(cluster2.changes.hasChanges() == false, "No changes");
    });
